<!-- BEGIN_TF_DOCS -->
# SCP Module

Templates an SCP with useful configurable statements. If no configuration is provided, this module will deploy nothing.

## Examples

An SCP that only allows use of the IAM, STS and EC2 services in the Ireland region.

```terraform
module "scp" {
  source  = "george-richardson/personal-org/aws//modules/scp"
  version = ">= 1.0.0"

  allow_services = ["iam", "sts", "ec2"]
  allow_regions  = ["eu-west-1]
}
```

### Adding your own SCP statements

Service Control Policies are an extremely powerful tool, however they are limited to a maximum of 5 attached to any one AWS Organization resource. If you find yourself hitting this limit you can add your own statements to the SCPs generated for any of the modules using the `override_policy_documents` variable.

For example:

```terraform
# Custom policy to deny creating users in IAM
data "aws_iam_policy_document" "custom_scp" {
  statement {
    sid       = "DenyCreateUser"
    effect    = "Deny"
    actions   = ["iam:CreateUser"]
    resources = ["*"]
  }
}

module "scp" {
  source  = "george-richardson/personal-org/aws//modules/scp"
  version = ">= 1.0.0"

  allow_services = ["iam", "sts", "ec2"]
  allow_regions  = ["eu-west-1]

  # Merge custom policy with generated policy from module.
  override_policy_documents = [data.aws_iam_policy_document.custom_scp.json]
}
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.2.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 4.9.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 4.22.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_organizations_policy.scp](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_policy) | resource |
| [aws_organizations_policy_attachment.attachment](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_policy_attachment) | resource |
| [aws_iam_policy_document.scp](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_allow_ec2_instance_types"></a> [allow\_ec2\_instance\_types](#input\_allow\_ec2\_instance\_types) | List of EC2 instance types to allow. If not set then all instance types are allowed. | `list(string)` | `[]` | no |
| <a name="input_allow_rds_instance_types"></a> [allow\_rds\_instance\_types](#input\_allow\_rds\_instance\_types) | List of RDS instance types to allow. If not set then all instance types are allowed. | `list(string)` | `[]` | no |
| <a name="input_allow_regions"></a> [allow\_regions](#input\_allow\_regions) | List of regions to allow AWS activity within. If not set then all regions are allowed. (Global services are ignored by this list) | `list(string)` | `[]` | no |
| <a name="input_allow_services"></a> [allow\_services](#input\_allow\_services) | List of services to allow API activity against. All other services will be blocked. Be careful about blocking IAM and other foundational services. If not set then all services are allowed. | `list(string)` | `[]` | no |
| <a name="input_attachments"></a> [attachments](#input\_attachments) | List of resources to attach this SCP to. | `list(string)` | `[]` | no |
| <a name="input_block_root_user"></a> [block\_root\_user](#input\_block\_root\_user) | Should the root user have all access blocked? | `bool` | `false` | no |
| <a name="input_name"></a> [name](#input\_name) | Name of the SCP document. | `string` | n/a | yes |
| <a name="input_override_policy_documents"></a> [override\_policy\_documents](#input\_override\_policy\_documents) | List of JSON SCP policy documents that will be merged with the generated SCP. | `list(string)` | `[]` | no |
| <a name="input_protected_iam_resources"></a> [protected\_iam\_resources](#input\_protected\_iam\_resources) | List of IAM ARNs which will be protected from modification by all users. | `list(string)` | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_scp"></a> [scp](#output\_scp) | ID of the SCP generated by this module. |
<!-- END_TF_DOCS -->